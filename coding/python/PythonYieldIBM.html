<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

	

  
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-CN" xml:lang="zh-CN">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
<title>Python yield 使用浅析</title>
<link rel="schema.DC" href="http://purl.org/DC/elements/1.0/"/>
<link rel="SHORTCUT ICON" href="http://www.ibm.com/favicon.ico"/>
<meta name="DC.Rights" content="© Copyright IBM Corporation 2012"/>
<meta name="Keywords" content="Python, yield, generator, iterable, tttosca, tttlca"/>
<meta name="DC.Date" scheme="iso8601" content="2012-11-22"/>
<meta name="Source"  content="v17 delivery:developerWorks"/>
<meta name="Security" content="Public"/>
<meta name="Abstract" content="初学 Python 的开发者经常会发现很多 Python 函数中用到了 yield 关键字，然而，带有 yield 的函数执行流程却和普通函数不一样，yield 到底用来做什么，为什么要设计 yield ？本文将由浅入深地讲解 yield 的概念和用法，帮助读者体会 Python 里 yield 简单而强大的功能。"/>
<meta name="Description" content="初学 Python 的开发者经常会发现很多 Python 函数中用到了 yield 关键字，然而，带有 yield 的函数执行流程却和普通函数不一样，yield 到底用来做什么，为什么要设计 yield ？本文将由浅入深地讲解 yield 的概念和用法，帮助读者体会 Python 里 yield 简单而强大的功能。"/>
<meta name="IBM.Effective" scheme="W3CDTF" content="2012-11-22"/>
<meta name="Owner" content="developerWorks/China/IBM"/>
<meta name="DC.Language" scheme="rfc1766" content="zh-CN"/>
<meta name="IBM.SpecialPurpose" content="SP001"/>
<meta name="IBM.Country" content="CN"/>
<meta name="Robots" content="index,follow"/>
<meta name="DC.Type" scheme="IBM_ContentClassTaxonomy" content="CT316" />
<meta name="DC.Subject" scheme="IBM_SubjectTaxonomy" content="TT400" />
<meta name="dW.ContentArea" content="7,2" />
<meta name="dW.Topic" content="46" />

<meta scheme="IBM_WTMCategory" name="IBM.WTMCategory" content="SOFDCOSRCN" />

<link rel="canonical" href="http://www.ibm.com/developerworks/cn/opensource/os-cn-python-yield/index.html"/>
<!-- HEADER_SCRIPTS_AND_CSS_INCLUDE -->
<link href="http://1.www.s81c.com/common/v17/css/www.css" rel="stylesheet" title="www"  type="text/css"/>
<link href="http://1.www.s81c.com/common/v17/css/country/cnzh.css" rel="stylesheet" title="www" type="text/css">
<!-- Masthead/footer -->
<link href="http://dw1.s81c.com/developerworks/css/dw-mf/v17/dw-mfN2015-01.css" media="screen,projection" rel="stylesheet" title="www" type="text/css"/>
<link href="http://dw1.s81c.com/developerworks/css/v17/dw-article-6.css" rel="stylesheet" title="www" type="text/css"/>
<link href="http://dw1.s81c.com/developerworks/css/v17/dw-common-features.css" rel="stylesheet" title="www" type="text/css"/>
<link href="http://dw1.s81c.com/developerworks/css/v17/dw-local-site-v17-N2014-05.css" media="screen,projection" rel="stylesheet" title="www" type="text/css"/>
<script type="text/javascript" src="http://1.www.s81c.com/common/js/dojo/www.js">//</script>
<script type="text/javascript" src="http://dw1.s81c.com/developerworks/js/v17/dw-www-v2.js">//</script> 
<script type="text/javascript">
//  ibmweb.config.set({ sbs: { enabled: false }});
</script>
<!-- Exp -->
  <script type="text/javascript">dojo.addOnLoad(function(){var dw_source="dwchina";var dw_register="注册免费的 Bluemix 试用版";var dw_connect="连接 Bluemix 开发者";var dw_vp="在 IBM Bluemix 云平台上开发并部署您的下一个应用。";var dw_cta="现在就开始免费试用";var dw_tile_alt="在 IBM Bluemix 云平台上开发并部署您的下一个应用。现在就开始免费试用";var dw_campaign="bluemix";var dw_content=window.location.pathname.split("/")[window.location.pathname.split("/").length-2];if(dw_content=="library"){dw_content=window.location.pathname.split("/")[window.location.pathname.split("/").length-1];dw_content=window.location.pathname.split("/")[window.location.pathname.split("/").length-3]+"-"+dw_content.substring(0,dw_content.indexOf(".html"))}var bluDevComURL="https://developer.ibm.com/bluemix/";var bluLink="https://www.bluemix.net/";var lnkID;var lnkIDd;var lnkIDt;var bLinkEnd;var bLinkTemp;var idTrkr=[];var idCnt;var artTop=dojo.query("div.ibm-col-1-1")[0];var artChildren=dojo.query(artTop).children();var edgy=false;if(dojo.hasClass(artChildren[0],"ibm-inset"))edgy=true;if((artChildren[0].nodeName=="H2")&&(dojo.hasClass(artChildren[1],"ibm-inset")))edgy=true;if(dojo.hasClass(artChildren[0],"codesection"))edgy=true;if((artChildren[0].nodeName=="H5")&&(dojo.hasClass(artChildren[1],"codesection")))edgy=true;if((artChildren[0].nodeName=="H5")&&(artChildren[1].width>=701))edgy=true;if(artChildren[1].width>=701)edgy=true;if(dojo.hasClass(artChildren[0],"ibm-data-table"))edgy=true;if((artChildren[0].nodeName=="H5")&&(dojo.hasClass(artChildren[1],"ibm-data-table")))edgy=true;if(!(edgy)){var sBarAB='<div class="dw-article-sidebar dw-bluemix" id="dwc-exp-a">'+'<img src="http://dw1.s81c.com/developerworks/i/bluemix-graphic.png" height="64" width="64" alt=""/>'+'<p>'+dw_vp+'</p>'+'<p class="ibm-button-link-alternate dw-button-green">'+'<a id="tutc-sbar-bmix-home-btn-ABa" href="http://www.ibm.com/developerworks/cn/opensource/os-cn-python-yield/'+bluLink+'" class="dw-button-large">'+dw_cta+'</a></p></div>';dojo.place(sBarAB,artTop,"first")}dojo.forEach(dojo.query("#ibm-content-main a"),function(item,index){var dw_medium="article";var bLink=dojo.attr(item,"href");var linkClass=dojo.attr(item,"class");if((dojo.attr(item,"id")!=null)&&(dojo.attr(item,"id").indexOf("-sbar-")>-1))dw_medium="sidebar";if((dojo.attr(item,"id")!=null)&&(dojo.attr(item,"id").indexOf("-vpromo-")>-1))dw_medium="video-promotion";if(bLink&&(bLink.indexOf("//bluemix.net")>-1))bLink=bLink.replace("//bluemix.net","//www.bluemix.net");if(bLink&&(bLink.indexOf("//ace.ng.bluemix.net")>-1))bLink=bLink.replace("//ace.ng.bluemix.net","//www.bluemix.net");if(bLink&&(bLink.indexOf("//console.ng.bluemix.net")>-1))bLink=bLink.replace("//console.ng.bluemix.net","//www.bluemix.net");if(bLink&&((bLink.indexOf("//www.bluemix.net")>-1)||(bLink.indexOf("//www.ng.bluemix.net")>-1)||(bLink.indexOf("//hub.jazz.net")>-1))){bLinkEnd="";bLink=bLink.split("?");if((bLink[1])&&(bLink[1].indexOf("/")!=-1))bLinkEnd=bLink[1].substring(bLink[1].indexOf("/"));bLink=bLink[0];if(bLink.indexOf("//hub.jazz.net")>-1){if((bLink.indexOf("//hub.jazz.net/git")>-1)||(bLink.indexOf("//hub.jazz.net/project")>-1)){bLink="https://login.jazz.net/psso/proxy/jazzregister?utm_source="+dw_source+"&utm_medium="+dw_medium+"&utm_content="+dw_content+"&utm_campaign="+dw_campaign+"&redirect_uri="+bLink}else{bLink=bLink+"?utm_source="+dw_source+"&utm_campaign="+dw_campaign+"&utm_content="+dw_content+"&utm_medium="+dw_medium}}else{if(bLink.indexOf("/#/")==-1){if(bLink.substring(bLink.length-7)=="/docs/#"){bLink=bLink.replace("/docs/#","/docs/"+"?cm_mmc="+dw_source+"-_-"+dw_campaign+"-_-"+dw_content+"-_-"+dw_medium+"#")}else{bLink=bLink+"?cm_mmc="+dw_source+"-_-"+dw_campaign+"-_-"+dw_content+"-_-"+dw_medium}}else{bLink=bLink.substring(0,bLink.indexOf("#"))+"?cm_mmc="+dw_source+"-_-"+dw_campaign+"-_-"+dw_content+"-_-"+dw_medium+bLink.substring(bLink.indexOf("#")-1)}}if(bLinkEnd)bLink=bLink+bLinkEnd;if(linkClass.indexOf("bluemix-home")==-1){if((bLink.indexOf("#")==-1)&&(bLink.indexOf("//www.bluemix.net/")!=-1))bLink=bLink.replace("//www.bluemix.net/","//apps.admin.ibmcloud.com/manage/trial/bluemix.html");if((bLink.indexOf("#")==-1)&&(bLink.indexOf("//www.bluemix.net?")!=-1))bLink=bLink.replace("//www.bluemix.net","//apps.admin.ibmcloud.com/manage/trial/bluemix.html")}dojo.attr(item,"href",bLink);}});});</script><!-- LEADSPACE_STYLES -->

</head>
<body id="ibm-com">
	<div id="ibm-top" class="ibm-landing-page">

<!-- MASTHEAD_BEGIN -->		
<div id="ibm-masthead">

    <!-- TOP ROW -->    
	<div id="dw-masthead-top-row">
		<ul id="ibm-mast-options-dw" role="toolbar" aria-label="Masthead navigation">
			<li id="dw-mast-top-4" role="presentation">
				<a href="http://www.ibm.com/developerworks/cn/" tabindex="0"><img src="http://dw1.s81c.com/developerworks/i/mf/dwn-dw-badge.png" width="43" height="22" alt="dW" aria-label="dW" /></a>
			</li>
			<li id="dw-mast-top-0" role="presentation">
				<div id="dw-mast-signin">
					<a id="dw-mf-signin-link" class="dw-mf-noscript" href="index.html#" title="登录需要启用 JavaScript" tabindex="2">登录</a>
					<span class="dw-mf-signin-spacer">|</span>
					<a id="dw-mf-reg-link" class="dw-mf-noscript" href="index.html#" title="注册需要启用 JavaScript" tabindex="3">注册</a>
				</div>
				<div id="dw-mast-auth-link" class="dw-mf-hide">
					<a class="authenticated ibm-active" href="index.html#" role="button" tabindex="2"></a>
					<ul id="dw-mast-auth-menu" class="dw-mf-hide">
						<li class="dw-mast-auth-menu-title" aria-hidden="true">developerWorks 社区</li>
						<li>
							<span class="dw-mast-auth-menu-arrow" aria-hidden="true">›</span><a href="http://www.ibm.com/developerworks/community/profiles/html/myProfileView.do?lang=zh" tabindex="3">我的概要信息</a>
						</li>
						<li>
							<span class="dw-mast-auth-menu-arrow" aria-hidden="true">›</span><a href="http://www.ibm.com/developerworks/community/groups/service/html/mycommunities?lang=zh" tabindex="4">我的社区</a>
						</li>
						<li>
							<span class="dw-mast-auth-menu-arrow" aria-hidden="true">›</span><a href="http://www.ibm.com/developerworks/community/news/?lang=zh" tabindex="5">设置</a>
						</li>
						<li class="dw-mast-auth-menu-divider"><hr/></li>
						<li>
							<span class="dw-mast-auth-menu-arrow" aria-hidden="true">›</span><a id="dw-mast-signout-link" href="index.html#" tabindex="6">退出</a>
						</li>
					</ul>				
				</div>
			</li>
			<li id="dw-mast-top-1">
				<div></div>
			</li>
			<li id="dw-mast-top-3" role="presentation">
				<a href="http://www.ibm.com/cn/zh/" tabindex="1">IBM</a>
			</li>
		</ul>
	</div>

    <!-- BOTTOM ROW -->
	<div id="ibm-universal-nav-dw" aria-label="Site map">
		<ul id="ibm-unav-links-dw">
			<li id="ibm-unav-home-dwlogo">
				<a href="http://www.ibm.com/developerworks/cn/"><img src="http://dw1.s81c.com/developerworks/i/mf/dwn-dw-wordmark.png" width="225" height="28" alt="developerWorks®" /></a>
			</li>
		</ul>
		<ul id="ibm-menu-links-dw" class="ibm-menu-links-dw-cn" role="toolbar" aria-label="Site map">
			<li id="dw-mast-nav-0" role="presentation"><a href="http://www.ibm.com/developerworks/cn/topics/" tabindex="0">技术主题</a></li>
			<li id="dw-mast-nav-1" role="presentation"><a href="http://www.ibm.com/developerworks/cn/downloads/" tabindex="0">软件下载</a></li>
			<li id="dw-mast-nav-2" role="presentation"><a href="http://www.ibm.com/developerworks/community/?lang=zh" tabindex="0">社区</a></li>
			<li id="dw-mast-nav-3" role="presentation"><a href="https://www.ibm.com/developerworks/community/groups/service/html/communityview?communityUuid=6d7f9e5d-5f89-4767-a006-a81b8d186370&amp;lang=zh" tabindex="0">技术讲座</a></li>
		</ul>
		<form id="ibm-search-form" action="http://www.ibm.com/search/csass/search/" method="get" name="form1" aria-label="搜索 developerWorks" role="search">
			<p>
				<label for="q"><span class="ibm-access">搜索 developerWorks</span></label>
				<input id="q" type="text" name="q" value="搜索 developerWorks" maxlength="100"/>
				<input type="hidden" name="sn" value="dw" />
				<input type="hidden" name="lang" value="zh" />
				<input type="hidden" name="cc" value="CN" />
				<input type="hidden" name="en" value="utf" />
				<input type="hidden" name="hpp" value="20" />
				<input type="hidden" name="dws" value="cndw" />
				<input type="hidden" name="lo" value="zh" />
				<input id="ibm-search" class="ibm-btn-search" type="submit" value="提交" />
			</p>
		</form>
	</div>    
	
</div>
<div id="fdiv" class="ibm-access"></div><!-- MASTHEAD_END -->
	    
<!-- LAYOUT -->
<!-- LEADSPACE_BEGIN --> 
<div id="ibm-leadspace-head">
	<!-- LEADSPACE_BODY_BEGIN --> 
	<div id="ibm-leadspace-body">
		<!-- Navigation_Trail_BEGIN -->
      <ul id="ibm-navigation-trail"><li><a href="http://www.ibm.com/developerworks/cn/">developerWorks 中国</a></li><li><a href="http://www.ibm.com/developerworks/cn/topics/">技术主题</a></li><li><a href="http://www.ibm.com/developerworks/cn/opensource/">Open source</a></li><li><a href="http://www.ibm.com/developerworks/cn/views/opensource/libraryview.jsp">文档库</a></li></ul>
		<!-- END_Navigation_Trail -->
			<!-- Title_Subtitle -->
			<h1>Python yield 使用浅析	</h1>
	</div>
	<!-- LEADSPACE_BODY_END --> 
	<!-- SUMMARY_BEGIN -->
	<div id="dw-summary-area" class="dw-summary-columns">
		<div class="ibm-col-6-4">
		<p>初学 Python 的开发者经常会发现很多 Python 函数中用到了 yield 关键字，然而，带有 yield 的函数执行流程却和普通函数不一样，yield 到底用来做什么，为什么要设计 yield ？本文将由浅入深地讲解 yield 的概念和用法，帮助读者体会 Python 里 yield 简单而强大的功能。</p>
		<p class="ibm-no-print ibm-ind-link">

			
			<span id="nCmts"></span>
		</p>
		</div>
		<div class="ibm-col-6-2 dw-toc-margin">
			<p class="dw-summary-author"><a href="index.html#authorN1001E" class="ibm-popup-link" onclick="ibmweb.overlay.show('authorN1001E',this);return false;">廖 雪峰</a>, 软件工程师, HP</p>
<div id="authorN1001E" class="ibm-common-overlay"><div class="ibm-head"><p><a href="index.html#close" class="ibm-common-overlay-close">关闭 [x]</a></p></div><div class="ibm-body"><div class="ibm-main"><div class="ibm-title"><!--this is where the h2 usually goes--></div><div class="ibm-container ibm-alternate"><div class="ibm-container-body">
<p><!--.-->
廖雪峰，精通 Java/Java EE/Java ME/Android/Python/C#/Visual Basic，对开源框架有深入研究，著有《Spring 2.0 核心技术与最佳实践》一书，创建有开源框架 JOpenID，其官方博客是 http://www.liaoxuefeng.com/ 和 http://michael-liao.appspot.com/。</p><br /><br /></div></div></div></div><div class="ibm-footer"><!----></div></div>
			<p class="dw-summary-date">2012 年 11 月 22 日</p>
			


			<div aria-hidden="true" class="ibm-container" id="dw-toc"><div class="ibm-container-body"><ul class="ibm-twisty"><li><a href="index.html#toggle" class="ibm-twisty-trigger"><img src="http://www.ibm.com/i/c.gif" alt="-"/></a><span class="ibm-twisty-head">内容</span><div class="ibm-twisty-body"><ul style="font-size:0.8em" class="ibm-link-list">
<li><a class="ibm-anchor-down-em-link" href="index.html#major1">如何生成斐波那契數列</a></li>
<li><a class="ibm-anchor-down-em-link" href="index.html#major2">return 的作用</a></li>
<li><a class="ibm-anchor-down-em-link" href="index.html#major3">另一个例子</a></li>
<li><a class="ibm-anchor-down-em-link" href="index.html#resources">参考资料 </a></li>
<li><a class="ibm-anchor-down-em-link" href="index.html#icomments">评论</a></li></ul></div></li></ul></div></div>
		</div>
	</div>
	<!-- SUMMARY_END -->
</div>
<!-- LEADSPACE_END -->

<div id="ibm-pcon">

<!-- BEGIN_IBM-CONTENT -->
<div id="ibm-content">

<!-- BEGIN_IBM-CONTENT-BODY -->
<div id="ibm-content-body">

<!-- BEGIN_IBM-CONTENT-MAIN -->
<div id="ibm-content-main">

<!-- 1_1_COLUMN_BEGIN -->
<div class="ibm-columns">
<div class="ibm-col-1-1">

<p>您可能听说过，带有 yield 的函数在 Python 中被称之为 generator（生成器），何谓 generator ？</p><p>我们先抛开 generator，以一个常见的编程题目来展示 yield 的概念。</p><h2 id="major1">如何生成斐波那契數列</h2><p>斐波那契（Fibonacci）數列是一个非常简单的递归数列，除第一个和第二个数外，任意一个数都可由前两个数相加得到。用计算机程序输出斐波那契數列的前 N 个数是一个非常简单的问题，许多初学者都可以轻易写出如下函数：</p><h5 id="listing1">清单 1. 简单输出斐波那契數列前 N 个数</h5><div class="codesection"><pre class="displaycode"> def fab(max): 
    n, a, b = 0, 0, 1 
    while n &lt; max: 
        print b 
        a, b = b, a + b 
        n = n + 1</pre></div><p>执行 fab(5)，我们可以得到如下输出：</p><div class="codesection"><pre class="displaycode"> &gt;&gt;&gt; fab(5) 
 1 
 1 
 2 
 3 
 5</pre></div><p>结果没有问题，但有经验的开发者会指出，直接在 fab 函数中用 print 打印数字会导致该函数可复用性较差，因为 fab 函数返回 None，其他函数无法获得该函数生成的数列。</p><p>要提高 fab 函数的可复用性，最好不要直接打印出数列，而是返回一个 List。以下是 fab 函数改写后的第二个版本：</p><h5 id="listing2">清单 2. 输出斐波那契數列前 N 个数第二版</h5><div class="codesection"><pre class="displaycode"> def fab(max): 
    n, a, b = 0, 0, 1 
    L = [] 
    while n &lt; max: 
        L.append(b) 
        a, b = b, a + b 
        n = n + 1 
    return L</pre></div><p>可以使用如下方式打印出 fab 函数返回的 List：</p><div class="codesection"><pre class="displaycode"> &gt;&gt;&gt; for n in fab(5): 
 ...     print n 
 ... 
 1 
 1 
 2 
 3 
 5</pre></div><p>改写后的 fab 函数通过返回 List 能满足复用性的要求，但是更有经验的开发者会指出，该函数在运行中占用的内存会随着参数 max 的增大而增大，如果要控制内存占用，最好不要用 List</p><p>来保存中间结果，而是通过 iterable 对象来迭代。例如，在 Python2.x 中，代码：</p><h5 id="listing3">清单 3. 通过 iterable 对象来迭代</h5><div class="codesection"><pre class="displaycode"> for i in range(1000): pass</pre></div><p>会导致生成一个 1000 个元素的 List，而代码：</p><div class="codesection"><pre class="displaycode"> for i in xrange(1000): pass</pre></div><p>则不会生成一个 1000 个元素的 List，而是在每次迭代中返回下一个数值，内存空间占用很小。因为 xrange 不返回 List，而是返回一个 iterable 对象。</p><p>利用 iterable 我们可以把 fab 函数改写为一个支持 iterable 的 class，以下是第三个版本的 Fab：</p><h5 id="listing4">清单 4. 第三个版本</h5><div class="codesection"><pre class="displaycode"> class Fab(object): 

    def __init__(self, max): 
        self.max = max 
        self.n, self.a, self.b = 0, 0, 1 

    def __iter__(self): 
        return self 

    def next(self): 
        if self.n &lt; self.max: 
            r = self.b 
            self.a, self.b = self.b, self.a + self.b 
            self.n = self.n + 1 
            return r 
        raise StopIteration()</pre></div><p>Fab 类通过 next() 不断返回数列的下一个数，内存占用始终为常数：</p><div class="codesection"><pre class="displaycode"> &gt;&gt;&gt; for n in Fab(5): 
 ...     print n 
 ... 
 1 
 1 
 2 
 3 
 5</pre></div><p>然而，使用 class 改写的这个版本，代码远远没有第一版的 fab 函数来得简洁。如果我们想要保持第一版 fab 函数的简洁性，同时又要获得 iterable 的效果，yield 就派上用场了：</p><h5 id="listing5">清单 5. 使用 yield 的第四版</h5><div class="codesection"><pre class="displaycode"> def fab(max): 
    n, a, b = 0, 0, 1 
    while n &lt; max: 
        yield b 
        # print b 
        a, b = b, a + b 
        n = n + 1 

'''</pre></div><p>第四个版本的 fab 和第一版相比，仅仅把 print b 改为了 yield b，就在保持简洁性的同时获得了 iterable 的效果。</p><p>调用第四版的 fab 和第二版的 fab 完全一致：</p><div class="codesection"><pre class="displaycode"> &gt;&gt;&gt; for n in fab(5): 
 ...     print n 
 ... 
 1 
 1 
 2 
 3 
 5</pre></div><p>简单地讲，yield 的作用就是把一个函数变成一个 generator，带有 yield 的函数不再是一个普通函数，Python 解释器会将其视为一个 generator，调用 fab(5) 不会执行 fab 函数，而是返回一个 iterable 对象！在 for 循环执行时，每次循环都会执行 fab 函数内部的代码，执行到 yield b 时，fab 函数就返回一个迭代值，下次迭代时，代码从 yield b 的下一条语句继续执行，而函数的本地变量看起来和上次中断执行前是完全一样的，于是函数继续执行，直到再次遇到 yield。</p><p>也可以手动调用 fab(5) 的 next() 方法（因为 fab(5) 是一个 generator 对象，该对象具有 next() 方法），这样我们就可以更清楚地看到 fab 的执行流程：</p><h5 id="listing6">清单 6. 执行流程</h5><div class="codesection"><pre class="displaycode"> &gt;&gt;&gt; f = fab(5) 
 &gt;&gt;&gt; f.next() 
 1 
 &gt;&gt;&gt; f.next() 
 1 
 &gt;&gt;&gt; f.next() 
 2 
 &gt;&gt;&gt; f.next() 
 3 
 &gt;&gt;&gt; f.next() 
 5 
 &gt;&gt;&gt; f.next() 
 Traceback (most recent call last): 
  File "&lt;stdin&gt;", line 1, in &lt;module&gt; 
 StopIteration</pre></div><p>当函数执行结束时，generator 自动抛出 StopIteration 异常，表示迭代完成。在 for 循环里，无需处理 StopIteration 异常，循环会正常结束。</p><p>我们可以得出以下结论：</p><p>一个带有 yield 的函数就是一个 generator，它和普通函数不同，生成一个 generator 看起来像函数调用，但不会执行任何函数代码，直到对其调用 next()（在 for 循环中会自动调用 next()）才开始执行。虽然执行流程仍按函数的流程执行，但每执行到一个 yield 语句就会中断，并返回一个迭代值，下次执行时从 yield 的下一个语句继续执行。看起来就好像一个函数在正常执行的过程中被 yield 中断了数次，每次中断都会通过 yield 返回当前的迭代值。</p><p>yield 的好处是显而易见的，把一个函数改写为一个 generator 就获得了迭代能力，比起用类的实例保存状态来计算下一个 next() 的值，不仅代码简洁，而且执行流程异常清晰。</p><p>如何判断一个函数是否是一个特殊的 generator 函数？可以利用 isgeneratorfunction 判断：</p><h5 id="listing7">清单 7. 使用 isgeneratorfunction 判断</h5><div class="codesection"><pre class="displaycode"> &gt;&gt;&gt; from inspect import isgeneratorfunction 
 &gt;&gt;&gt; isgeneratorfunction(fab) 
 True</pre></div><p>要注意区分 fab 和 fab(5)，fab 是一个 generator function，而 fab(5) 是调用 fab 返回的一个 generator，好比类的定义和类的实例的区别：</p><h5 id="listing8">清单 8. 类的定义和类的实例</h5><div class="codesection"><pre class="displaycode"> &gt;&gt;&gt; import types 
 &gt;&gt;&gt; isinstance(fab, types.GeneratorType) 
 False 
 &gt;&gt;&gt; isinstance(fab(5), types.GeneratorType) 
 True</pre></div><p>fab 是无法迭代的，而 fab(5) 是可迭代的：</p><div class="codesection"><pre class="displaycode"> &gt;&gt;&gt; from collections import Iterable 
 &gt;&gt;&gt; isinstance(fab, Iterable) 
 False 
 &gt;&gt;&gt; isinstance(fab(5), Iterable) 
 True</pre></div><p>每次调用 fab 函数都会生成一个新的 generator 实例，各实例互不影响：</p><div class="codesection"><pre class="displaycode"> &gt;&gt;&gt; f1 = fab(3) 
 &gt;&gt;&gt; f2 = fab(5) 
 &gt;&gt;&gt; print 'f1:', f1.next() 
 f1: 1 
 &gt;&gt;&gt; print 'f2:', f2.next() 
 f2: 1 
 &gt;&gt;&gt; print 'f1:', f1.next() 
 f1: 1 
 &gt;&gt;&gt; print 'f2:', f2.next() 
 f2: 1 
 &gt;&gt;&gt; print 'f1:', f1.next() 
 f1: 2 
 &gt;&gt;&gt; print 'f2:', f2.next() 
 f2: 2 
 &gt;&gt;&gt; print 'f2:', f2.next() 
 f2: 3 
 &gt;&gt;&gt; print 'f2:', f2.next() 
 f2: 5</pre></div><div class="ibm-alternate-rule"><hr/></div><p class="ibm-ind-link ibm-back-to-top"><a href="index.html#ibm-pcon" class="ibm-anchor-up-link">回页首</a></p><h2 id="major2">return 的作用</h2><p>在一个 generator function 中，如果没有 return，则默认执行至函数完毕，如果在执行过程中 return，则直接抛出 StopIteration 终止迭代。</p><div class="ibm-alternate-rule"><hr/></div><p class="ibm-ind-link ibm-back-to-top"><a href="index.html#ibm-pcon" class="ibm-anchor-up-link">回页首</a></p><h2 id="major3">另一个例子</h2><p>另一个 yield 的例子来源于文件读取。如果直接对文件对象调用 read() 方法，会导致不可预测的内存占用。好的方法是利用固定长度的缓冲区来不断读取文件内容。通过 yield，我们不再需要编写读文件的迭代类，就可以轻松实现文件读取：</p><h5 id="listing9">清单 9. 另一个 yield 的例子</h5><div class="codesection"><pre class="displaycode"> def read_file(fpath): 
    BLOCK_SIZE = 1024 
    with open(fpath, 'rb') as f: 
        while True: 
            block = f.read(BLOCK_SIZE) 
            if block: 
                yield block 
            else: 
                return</pre></div><p>以上仅仅简单介绍了 yield 的基本概念和用法，yield 在 Python 3 中还有更强大的用法，我们会在后续文章中讨论。</p><p>注：本文的代码均在 Python 2.7 中调试通过</p><!--CMA ID: 846770--><!--Site ID: 10--><!--XSLT stylesheet used to transform this file: dw-document-html-7.0.xsl-->


</div>
</div>
<!-- 1_1_COLUMN_END -->

<!-- SPLIT_COLUMNS_BEGIN -->
<div class="ibm-columns">

<!-- 6_4_COLUMN_BEGIN -->
<div class="ibm-col-6-4">

<h2 id="resources" class="ibm-rule">参考资料 </h2><h3 class="dw-resources-category-heading">学习</h3><ul class="ibm-bullet-list"><li>随时关注 developerWorks <a href="http://www.ibm.com/developerworks/cn/offers/techbriefings/">技术活动</a>和 <a href="http://www.ibm.com/developerworks/cn/swi/">网络广播</a>。</li><li>访问 developerWorks <a href="http://www.ibm.com/developerworks/cn/opensource/">Open source 专区</a>获得丰富的 how-to 信息、工具和项目更新以及 <a href="http://www.ibm.com/developerworks/cn/opensource/best2009/index.html">最受欢迎的文章和教程</a>，帮助您用开放源码技术进行开发，并将它们与 IBM 产品结合使用。</li></ul><h3 class="dw-resources-category-heading">讨论</h3><ul class="ibm-bullet-list"><li>加入 <a href="http://www.ibm.com/developerworks/cn/community/">developerWorks 中文社区</a>，developerWorks 社区是一个面向全球 IT 专业人员，可以提供博客、书签、wiki、群组、联系、共享和协作等社区功能的专业社交网络社区。</li><li>加入 <a href="https://www.ibm.com/developerworks/mydeveloperworks/groups/service/html/communityview?communityUuid=38997896-bb16-451a-aa97-189a27a3cd5a/?lang=zh" onmouseover="linkQueryAppend(this)">IBM 软件下载与技术交流群组</a>，参与在线交流。</li></ul>

<!-- INLINE_COMMENTS_BEGIN -->
<h2 id="icomments" class="ibm-alternate-rule ibm-no-print">条评论</h2>
    
<div class="ibm-no-print" id="dw-icomments-container">	
	<div id="threadShow"></div>
</div>
<!-- Sign in OVERLAY STARTS HERE -->
    
<!-- Sign in OVERLAY STARTS HERE -->
<div class="ibm-common-overlay" id="signin_overlay">
<div class="ibm-head">
<p><a class="ibm-common-overlay-close" href="index.html#" onclick="dwsi.siInst.clearForm();">关闭 [x]</a></p>
</div>
<div class="ibm-body">
<div class="ibm-main">

 <div class="ibm-title">
<h2>developerWorks: 登录</h2>
<div id="ibm-overlay-error-signin" class="no-display"></div>
</div>
<div class="ibm-container ibm-alternate ibm-buttons-last">
<div class="ibm-container-body">
<p class="ibm-overlay-intro">标有星（<span class="ibm-required">*</span>）号的字段是必填字段。</p> 
<form class="ibm-column-form" id="sFormId" action="index.html" method="post" name="sForm" onsubmit="return false;">
<p><label for="ibmid">IBM ID:<span class="ibm-required">*</span></label><span>
    <input name="ibm-id" id="ibmid" size="25" value="" class="required" type="text" onkeypress="dwsi.siInst.handleEP(event,this.form);" />
    <br /><a onclick="window.location='/developerworks/dwwi/DWAuthRouter?m=reg&amp;lang=zh_CN&amp;d='+encodeURIComponent(location.protocol + '//' + location.hostname + location.pathname + '#icomments'); return false;" href="index.html#" class="ibm-forward-link">需要一个 IBM ID？</a> <br />
    <a class="ibm-forward-link" href="http://www.ibm.com/developerworks/dwwi/jsp/WSHelp.jsp?lang=zh_CN">忘记 IBM ID？</a> 
</span>
</p> 
<p><label for="password">密码：<span class="ibm-required">*</span></label><span>
    <input name="password" id="password" size="25" value="" class="required" type="password" onkeypress="dwsi.siInst.handleEP(event,this.form);" />
    <br /><a class="ibm-forward-link" href="index.html#" onclick="(function ()
        {window.location='https://www.ibm.com/account/profile?page=forgot&amp;lang=zh_CN&amp;appname=ibm&amp;required=null&amp;d='+encodeURIComponent(dwsi.siInst.getAuthUrl())+'%3Fm%3Dloginpage%26lang%3Dzh_CN%26d%3D'+encodeURIComponent(location.href);})();">忘记密码？</a>
    <br /><a class="ibm-forward-link" href="index.html#" onclick="(function () {window.location='https://www.ibm.com/account/profile?page=chpw&amp;lang=zh_CN&amp;appname=ibm&amp;required=null&amp;d='+encodeURIComponent(location.href);})();">更改您的密码</a></span></p> 
<p class="dw-perm-box">
	<span><input id="perm" type="checkbox" name="perm_name"/><label for="perm"> 保持登录。</label></span>
</p>
<p>单击提交则表示您同意developerWorks 的条款和条件。 <a
    href="http://www.ibm.com/developerworks/community/terms?lang=zh">查看条款和条件</a>。</p>
<div class="ibm-buttons-row">
   <p><input class="ibm-btn-arrow-pri" name="ibm-submit" value="提交" onclick="dwsi.siInst.signin();return false;" type="submit" /><span class="ibm-sep">&nbsp;</span>
<input value="取消" type="button" name="ibm-cancel" class="ibm-btn-cancel-sec" onclick="dwsi.siInst.clearForm();ibmweb.overlay.hide('signin_overlay');return false;"/></p>
</div>
</form>
 <div class="ibm-overlay-rule"><hr /></div> 

<p>在您首次登录 developerWorks 时，会为您创建一份个人概要。<strong>您的个人概要中的信息（您的姓名、国家/地区，以及公司名称）是公开显示的，而且会随着您发布的任何内容一起显示，除非您选择隐藏您的公司名称。</strong>您可以随时更新您的 IBM 帐户。</p>
<div><p class="dw-c-overlay-secure">所有提交的信息确保安全。</p></div>
</div>
</div>
</div>
</div>
<div class="ibm-footer"></div>
</div>
<!-- Display name OVERLAY STARTS HERE -->
<div class="ibm-common-overlay" id="displayname_overlay">
<div class="ibm-head">
<p><a class="ibm-common-overlay-close" href="index.html#" onclick="dwsi.siInst.clearForm();">关闭 [x]</a></p>
</div>
<div class="ibm-body">
<div class="ibm-main">
<div class="ibm-title">
<h2>选择您的昵称</h2><br /><br />
<div id="ibm-overlay-error-dname" class="no-display"></div>
</div>
<div class="ibm-container ibm-alternate ibm-buttons-last">
<div class="ibm-container-body">
<p class="ibm-overlay-intro">当您初次登录到 developerWorks 时，将会为您创建一份概要信息，您需要指定一个昵称。您的昵称将和您在 developerWorks 发布的内容显示在一起。</p><p><strong>昵称长度在 3 至 31 个字符之间</strong>。 
    您的昵称在 developerWorks 社区中必须是唯一的，并且出于隐私保护的原因，不能是您的电子邮件地址。</p>
<p class="ibm-overlay-intro">标有星（<span class="ibm-required">*</span>）号的字段是必填字段。</p> 
<form id="dFormId" method="post" action="index.html" name="dForm" onsubmit="return false;" class="ibm-column-form">
<p><label for="displayname">昵称：<span class="ibm-required">*</span></label><span>
    <input name="displayname" id="displayname" size="25" value="" type="text" onkeypress="dwsi.siInst.handleEP(event,this.form);" /></span>
    <span class="ibm-form-note">(昵称长度在 3 至 31 个字符之间)</span>
</p>
<p>单击<strong>提交</strong>则表示您同意developerWorks 的条款和条件。 <a href="http://www.ibm.com/developerworks/community/terms?lang=zh">查看条款和条件</a>.</p>
<div class="ibm-buttons-row">
   <p><input class="ibm-btn-arrow-pri" name="ibm-submit" value="提交" onclick="dwsi.siInst.signin();return false;" type="submit" /><span class="ibm-sep">&nbsp;</span>
<input value="取消" type="button" name="ibm-cancel" class="ibm-btn-cancel-sec" onclick="dwsi.siInst.clearForm();ibmweb.overlay.hide('displayname_overlay');return false;" /></p>
</div>
</form>
<div class="ibm-overlay-rule"><hr /></div>
<div><p class="dw-c-overlay-secure">所有提交的信息确保安全。</p></div>
</div>
</div>
</div>
</div>
<div class="ibm-footer"></div>
</div>


<!-- INLINE_COMMENTS_END -->

</div>
<!-- 6_4_COLUMN_END -->

<!-- 6_2_COLUMN_BEGIN -->
<div class="ibm-col-6-2">

<!-- Next_Steps -->
<!-- Dig_Deeper -->


<!-- Promotion_Module -->
    
<!-- PROMOTION_MODULE_START -->
<div class="ibm-alternate-rule"><hr /></div>
<ul class="ibm-portrait-module-list">
<li><img height="60" width="60" src="http://www.ibm.com/developerworks/i/sm-f-cl-puresystems70.jpg" alt=""/>
<h3><a class="ibm-feature-link"
    href="http://www.ibm.com/developerworks/cn/puresystems/">IBM PureSystems</a></h3>
<p>IBM PureSystems™ 系列解决方案是一个专家集成系统</p></li>
<li><img height="60" width="60" src="http://www.ibm.com/developerworks/i/sm-f-knowledgepath50.jpg" alt=""/>
<h3><a class="ibm-feature-link" href="http://www.ibm.com/developerworks/cn/views/global/libraryview.jsp?type_by=Knowledge+paths">developerWorks 学习路线图</a></h3>
<p>通过学习路线图系统掌握软件开发技能</p></li>
<li><img height="60" width="60" src="http://www.ibm.com/developerworks/i/sm-f-evaluationsoftware60.png" alt=""/>
<h3><a class="ibm-feature-link" href="http://www.ibm.com/developerworks/cn/downloads/">软件下载资源中心</a></h3>
<p>软件下载、试用版及云计算</p></li>
</ul>
<!-- PROMOTION_MODULE_END -->

</div>
<!-- 6_2_COLUMN_END -->

</div>
<!-- SPLIT_COLUMNS_END -->

<!-- BOTTOM_BACK_TO_TOP -->
<div class="ibm-columns">
<div class="ibm-col-1-1">
	<div class="ibm-alternate-rule"><hr/></div><p class="ibm-ind-link ibm-back-to-top"><a href="index.html#ibm-pcon" class="ibm-anchor-up-link">回页首</a></p>
</div>
</div>

<!-- Rating_Meta_BEGIN -->
<!--Rating_Meta_BEGIN--><div class="metavalue">static.content.url=http://www.ibm.com/developerworks/js/artrating/</div><div class="metavalue">SITE_ID=10</div><div class="metavalue">Zone=Open source, Linux</div><div class="metavalue">ArticleID=846770</div><div class="metavalue">ArticleTitle=Python yield 使用浅析	</div><div class="metavalue">publish-date=11222012</div><script language="javascript" type="text/javascript">document.write('<div class="metavalue">url='+location.href.replace(/</g,  '%3C')+'</div>');</script><!--Rating_Meta_END-->
<!-- Rating_Meta_END -->

</div>
<!-- END_IBM_CONTENT_MAIN -->

</div>
<!-- END_IBM_CONTENT_BODY -->

</div>
<!-- END_IBM_CONTENT -->

</div>
<!-- END_IBM_PCON -->
<!-- FOOTER_BEGIN -->
<div id="ibm-footer"><!-- IBM footer container; disabled --></div>

<div id="ibm-footer-module-dwwrapper" role="contentinfo" aria-label="developerWorks Footer">

<div id="ibm-footer-module-dw">
	<div class="dw-footer-columns">
		<div class="dw-footer-col-6-1 dw-footer-col-6-1-cn">
			<ul>
				<li><a href="https://www.ibm.com/developerworks/secure/feedback.jsp?domain=dwchina" tabindex="0">帮助</a></li>
				<li><a href="http://www.ibm.com/developerworks/cn/author/" tabindex="0">联系编辑</a></li>
				<li><a href="https://www.ibm.com/developerworks/secure/myideas2.jsp?domain=dwchina&start=true" tabindex="0">提交内容</a></li>
				<li><a href="http://www.ibm.com/developerworks/cn/rss/" tabindex="0">订阅源</a></li>
			</ul>
        </div>
		<div class="dw-footer-col-6-2">
			<ul>
				<li><a href="http://www.ibm.com/vrm/newsletter/10104?S_TACT=105AGX52&S_CMP=dwcntop" tabindex="0">在线浏览每周时事通讯</a></li>
				<li><a class="dwcn-sina-link" href="http://weibo.com/ibmdw/" target="_blank" tabindex="0">新浪微博</a></li>
				<li><a href="https://www.ibm.com/developerworks/community/report?lang=zh" tabindex="0">报告滥用</a></li>
				<li><a href="https://www.ibm.com/developerworks/community/terms?lang=zh" tabindex="0">使用条款</a></li>
				<li><a href="https://www.ibm.com/developerworks/cn/community/terms/thirdparty/" tabindex="0">第三方提示</a></li>
			</ul>
		</div>
		<div class="dw-footer-col-6-3">
			<ul>
				<li><a href="http://www.ibm.com/privacy/cn/zh/" tabindex="0">隐私条约</a></li>
				<li><a href="http://www.ibm.com/ibm/accessibility/cn/" tabindex="0">浏览辅助</a></li>
				<li><a href="http://www.ibm.com/developerworks/cn/academic/" tabindex="0">IBM 教育学院教育培养计划</a></li><li><a href="http://www.ibm.com/developerworks/cn/gep/">IBM 创业企业全球扶持计划</a></li><li><a href="http://www.ibm.com/partnerworld/isv/">ISV 资源 (英语)</a></li>
			</ul>
		</div>
		<div class="dw-footer-col-6-4"> 
			<ul>
				<li><a href="http://www.ibm.com/developerworks/cn/newsletter/" tabindex="0">dW 中国每周时事通讯</a></li>
			</ul>
			</form>
		</div>
		<div class="dw-footer-col-6-5">
			<ul>
				<li class="dw-footer-lang-head">选择语言：</li>
				<li><a href="http://www.ibm.com/developerworks/" tabindex="0">English</a></li>
				<li><a href="http://www.ibm.com/developerworks/cn/" lang="zh" tabindex="0">中文</a></li>
				<li><a href="http://www.ibm.com/developerworks/jp/" lang="ja" tabindex="0">日本語</a></li>
				<li><a href="http://www.ibm.com/developerworks/ru/" lang="ru" tabindex="0">Русский</a></li>
				<li><a href="http://www.ibm.com/developerworks/br/" lang="pt" tabindex="0">Português (Brasil)</a></li>
				<li><a href="http://www.ibm.com/developerworks/ssa/" lang="es" tabindex="0">Español</a></li>
				<li><a href="http://www.ibm.com/developerworks/vn/" lang="vi" tabindex="0">Việt</a></li>
			</ul>
		</div>
		<div class="dw-footer-col-6-6">
			<img width="223" height="46" alt="IBM®" src="http://dw1.s81c.com/developerworks/i/mf/dwn-ibm-logo-v17.png">
			<img class="dw-preload" src="http://1.www.s81c.com/i/v17/icons/ibm_sprite_social_blue_ON.png" alt="" width="1" height="1"/>
		</div>
	</div>
</div>

</div><!-- FOOTER_END -->

<!-- END_IBM-TOP -->
</div>

<!-- SCRIPTS_INCLUDE_BEGIN -->
<script type="text/javascript" src="http://www.ibm.com/developerworks/js/v17/dw-comments.js">//</script>
<script type="text/javascript" language="JavaScript">
	dojo.ready(function(){
		rBHash = typeof rBHash == "undefined" ? {} : rBHash;
		rBHash['viperLang'] = 'zh';
		rBHash['urlLang'] = 'cn';
		rBHash['dwwi2Lang'] = 'zh_CN';
		rBHash['appCode'] = 'dwmav';
		rBHash['signoutUrl'] = (location.host.toLowerCase() === "www.ibm.com" || location.host.toLowerCase() === "developer.ibm.com") ? 'http://www.ibm.com/developerworks/cn/' : ''; 
		dwsi.siInst = new dwweb.dynnav.dwsi();
		dwsi.siInst.initSI();		

		// construct the comment widget
dwc.cmts = '条评论';
dwc.signInPreText = '请';
dwc.signIn = '登录';
dwc.or = '或';
dwc.register = '注册';
dwc.signInPostText = '';
dwc.leaveCmt = '后发表评论。';
dwc.view = '查看';
dwc.totalCmts = '共有评论';
dwc.postYourCmt = '添加您的评论';
dwc.show = '显示：';
dwc.recentCmts = '最新评论';
dwc.allCmts = '所有评论';
dwc.tooLongCmt = '您的评论超过了 1000 字符限制';
dwc.numCharsLeft = '剩余 <span id="charCount">{1}</span> 字符';
dwc.reportAbuse = '报告滥用';
dwc.notifyMsg = '有新评论时提醒我';
dwc.htmlWarning = '注意：评论中不支持 HTML 语法'; 
dwc.cmt = '评论：';
dwc.addCmts = '添加评论';
dwc.addCmt = '添加评论';
dwc.doNotErase = '--在下方添加评论--'; 
dwc.viewOrAddCmts = '查看或添加评论';
dwc.reportInapprCont = '举报不良信息';
dwc.reportInapprContLink = 'http://www.ibm.com/developerworks/forums/forum.jspa?forumID=1834';
dwc.postingCmt = '正在发布评论……';
dwc.noCmt = '快来添加第一条评论';
dwc.netwkErr = '在检索评论时出错，请稍后刷新。';
dwc.addACmt = '添加评论';
dwc.instructCmt = '标有星号（<span class="ibm-required">*</span>）的是必填项目。';
dwc.btnPost = '发布';
dwc.btnPostAnon = '匿名发布';
dwc.btnClrCmt = '清除评论';
dwc.btnCancel = '取消';
dwc.showRecent = '显示最新的 {1} 条评论'; // {1} is the count to be substituted
dwc.showNext = '显示后 {1} 条评论'; // {1} is the count to be substituted
dwc.showAllCmts = '显示所有评论';
dwc.enterCmt = '请输入评论内容。';
dwc.loginErr = '暂时无法验证您的登录状态，请稍后再试。';
dwc.postErr = '暂时无法发布您的评论，请稍后再试。';
dwc.postBy = '由 <strong>{1}</strong>  于 {2} '; // {1} is the author to be substituted; {2} is the date
dwc.siteId = 10;
dwc.lang = 'zh_CN';
dwc.viperLang = 'zh';
//dwc.abuseHref =  null;
dwc.maxChars = 1000;
dwc.cmtTxt =  '评论：';
dwc.cmtsTxt =  '评论：';  
		dwc && new dwc.comments('threadShow','95%',5,'nCmts','icomments');
		});
</script>



<!-- BEGIN: Use this section to set page specific variables for the Unica Page Tag -->
<script language="JavaScript">var NTPT_PGEXTRA="ibmSkillLevel=1&ibmCmaId=846770&ibmContentAreas=opensource,linux";</script>
<!--END --><!-- SCRIPTS_INCLUDE_END -->

<div id="ibm-metrics">
<script src="http://dw1.s81c.com/common/stats/stats.js" type="text/javascript">//</script>
</div>

</body>
</html>
